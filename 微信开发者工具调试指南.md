# 微信开发者工具调试指南

## 🎯 快速调试流程

### 第一步：后台生成小程序码

1. **登录后台**
   - 网址：https://cwsp.com/admin
   - 刷新页面：`Ctrl+F5`

2. **配置参数**
   - 选择商品（ID = 39）
   - 日期：2026-02-12
   - 分类：生产全程回放（type=0）
   - 环境：体验版

3. **生成小程序码**
   - 点击"生成二维码"
   - 等待生成成功

4. **获取调试路径** ⭐
   生成成功后会显示：
   ```
   📱 微信开发者工具调试路径：
   packageA/goods/detail?scene=id%3D39%26date%3D20260212%26type%3D0

   [复制路径]
   ```

5. **复制路径**
   - 点击"复制路径"按钮
   - 或手动选择路径并复制

---

### 第二步：在微信开发者工具中调试

#### 方法A：使用编译模式（推荐）

1. **打开微信开发者工具**
   - 打开项目：`/Users/peakom/worko/kaichengbugong/cwlsuniapp`

2. **添加编译模式**
   - 点击顶部工具栏的"普通编译"下拉菜单
   - 选择"添加编译模式"

3. **配置编译模式**
   - **模式名称：** 扫码测试（商品39）
   - **启动页面：** 粘贴刚才复制的路径
     ```
     packageA/goods/detail?scene=id%3D39%26date%3D20260212%26type%3D0
     ```
   - **启动参数：** 留空
   - 点击"确定"

4. **开始调试**
   - 选择刚创建的编译模式
   - 点击"编译"按钮
   - 小程序会自动加载并模拟扫码进入

5. **查看调试日志**
   - 切换到"Console"标签
   - 查看输出的调试信息

   **预期输出：**
   ```
   ========== 页面加载参数 ==========
   完整参数 e: {"scene":"id%3D39%26date%3D20260212%26type%3D0"}
   ========== 扫码进入 ==========
   原始 scene: id%3D39%26date%3D20260212%26type%3D0
   解码后 scene: id=39&date=20260212&type=0
   解析 id: 39
   解析 goods_id: null
   ✅ 使用 id: 39
   解析 date: 20260212
   ✅ 日期转换: 2026-02-12
   解析 type: 0
   ✅ 分类设置: 0
   ========== 最终参数 ==========
   商品ID: 39
   目标日期: 2026-02-12
   目标分类: 0
   ===================================
   ```

6. **验证页面效果**
   - 查看商品信息是否显示
   - 查看日期是否自动选中
   - 查看分类是否自动切换
   - 查看视频列表是否加载

---

#### 方法B：直接在地址栏输入

1. **打开项目**
   - 微信开发者工具打开小程序项目

2. **修改启动路径**
   - 在工具栏找到页面路径输入框
   - 粘贴完整路径：
     ```
     packageA/goods/detail?scene=id%3D39%26date%3D20260212%26type%3D0
     ```
   - 按回车键

3. **查看效果**
   - 页面会重新加载
   - 查看 Console 日志

---

### 第三步：分析调试结果

#### ✅ 成功的标志

**日志输出：**
- ✅ 能看到 "========== 页面加载参数 =========="
- ✅ scene 正确解码
- ✅ 所有参数正确解析
- ✅ 商品ID、日期、分类都正确

**页面表现：**
- ✅ 商品详情正常显示
- ✅ 日期自动选中 2026-02-12
- ✅ 分类自动切换到"生产全程回放"
- ✅ 视频列表正常加载

---

#### ❌ 常见问题

##### 问题1：没有看到任何调试日志

**原因：** 代码未更新

**解决：**
1. 确认 `packageA/goods/detail.vue` 文件已修改
2. 重新编译小程序（点击"编译"按钮）
3. 如果还不行，清除缓存：工具 → 清除缓存 → 清除所有缓存

---

##### 问题2：日志显示 "❌ 未解析到商品ID"

**可能原因：**
- scene 格式不对
- getQueryString 方法有问题

**解决：**
1. 检查日志中的 "解码后 scene" 是否正确
2. 应该是：`id=39&date=20260212&type=0`
3. 如果不是，检查后台生成的 scene 参数

---

##### 问题3：商品信息不显示

**可能原因：**
1. 商品ID解析失败
2. API接口问题
3. 网络问题

**解决：**
1. 查看 Console 日志，确认商品ID
2. 查看 Network 标签，检查 API 请求
3. 确认 API 返回的数据

---

##### 问题4：日期或分类没有自动定位

**检查日志：**
- 查看 "解析 date" 和 "解析 type"
- 查看 "日期转换" 是否成功
- 查看 "最终参数" 是否正确

**可能原因：**
1. 日期格式转换失败
2. targetDate 没有正确设置
3. getDateList 方法未正确处理 targetDate

---

### 第四步：调试不同参数

#### 测试不同日期

后台修改日期，重新生成，使用新路径调试：
```
packageA/goods/detail?scene=id%3D39%26date%3D20260215%26type%3D0
```

#### 测试不同分类

修改 type 参数：
- `type=0` - 生产全程回放
- `type=1` - 精彩瞬间
- `type=2` - 多视角回放
- `type=3` - 配料回放

```
packageA/goods/detail?scene=id%3D39%26date%3D20260212%26type%3D1
```

#### 测试不同商品

修改 id 参数：
```
packageA/goods/detail?scene=id%3D40%26date%3D20260212%26type%3D0
```

---

## 📊 参数对照表

| 后台生成 | URL 编码 | 解码后 | 说明 |
|---------|---------|--------|------|
| `id=39` | `id%3D39` | `id=39` | 商品ID |
| `date=20260212` | `date%3D20260212` | `date=20260212` | 日期（短格式） |
| `type=0` | `type%3D0` | `type=0` | 分类 |
| `&` | `%26` | `&` | 参数分隔符 |

---

## 🔧 高级调试技巧

### 1. 修改启动参数

直接修改编译模式的参数，无需重新生成小程序码：
```
packageA/goods/detail?scene=id%3D99%26date%3D20261231%26type%3D3
```

### 2. 断点调试

在 `onLoad` 方法中设置断点：
1. 在代码编辑器中找到 `detail.vue`
2. 在 `onLoad` 方法的第一行点击设置断点
3. 重新编译
4. 程序会在断点处暂停，可以单步调试

### 3. 查看变量值

在 Console 中输入变量名查看值：
```javascript
this.id           // 商品ID
this.targetDate   // 目标日期
this.curNow       // 当前分类
this.videoList    // 视频列表
```

### 4. 手动调用方法

在 Console 中手动调用方法：
```javascript
this.getVideoList()  // 重新加载视频列表
this.getDateList('')  // 重新加载日期列表
```

---

## ✅ 调试完成后

### 确认功能正常
- [ ] 商品信息显示正常
- [ ] 日期自动选中
- [ ] 分类自动切换
- [ ] 视频列表加载成功
- [ ] 所有参数解析正确

### 准备上线
1. 移除或注释调试日志（console.log）
2. 重新上传小程序
3. 提交审核
4. 后台切换到"正式版"环境

---

## 💡 小技巧

### 保存常用编译模式

为不同场景创建编译模式：
- 商品39 - 生产全程回放
- 商品39 - 精彩瞬间
- 商品40 - 配料回放

这样可以快速切换测试。

### 对比正常跳转和扫码跳转

创建两个编译模式对比：

**模式1：正常跳转**
```
packageA/goods/detail?id=39&date=2026-02-12&type=0
```

**模式2：扫码跳转**
```
packageA/goods/detail?scene=id%3D39%26date%3D20260212%26type%3D0
```

对比两种方式的区别。

---

## 🎓 场景参数格式说明

### scene 参数的特殊性

**扫码进入时：**
- 所有参数都在 `scene` 中
- scene 是 URL 编码的字符串
- 需要先 `decodeURIComponent` 解码
- 再用 `getQueryString` 解析各个参数

**正常跳转时：**
- 参数直接在 URL query 中
- 可以直接从 `options` 获取
- 不需要解码和额外解析

这就是为什么需要特殊处理 scene 参数！

---

**现在请按照这个指南在微信开发者工具中调试！** 🚀
