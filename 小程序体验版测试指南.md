# 小程序体验版测试指南

## 📱 完整测试流程

### 第一步：上传小程序到体验版

#### 1. 打开微信开发者工具
- 项目路径：`/Users/peakom/worko/kaichengbugong/cwlsuniapp`

#### 2. 编译检查
- 工具会自动编译
- 检查是否有报错
- 确认修改的文件已生效

#### 3. 上传代码
1. 点击右上角"上传"按钮
2. 填写版本信息：
   - **版本号：** v1.5.2
   - **项目备注：** 优化小程序码参数解析，支持扫码自动定位日期和分类
3. 点击"上传"按钮

#### 4. 设置为体验版
1. 上传成功后，登录微信公众平台
2. 网址：https://mp.weixin.qq.com/
3. 进入"版本管理"页面
4. 找到刚上传的版本
5. 点击"设为体验版"按钮

---

### 第二步：添加体验成员

#### 1. 进入成员管理
- 在微信公众平台，点击"成员管理" → "项目成员"

#### 2. 添加体验成员
- 点击"添加成员"
- 输入微信号
- 选择"体验者"权限
- 保存

#### 3. 获取体验版二维码
- 在"版本管理" → "体验版"
- 点击"体验版二维码"
- 保存或打印二维码

---

### 第三步：安装体验版小程序

#### 1. 体验成员扫码
- 使用微信扫描"体验版二维码"
- 不是普通的小程序码，而是体验版专用二维码！

#### 2. 安装体验版
- 扫码后会提示"打开体验版小程序"
- 点击"进入小程序"
- 体验版会显示"体验版"标识

#### 3. 验证安装成功
- 小程序界面右上角会显示"体验版"字样
- 可以正常浏览小程序功能

---

### 第四步：后台生成体验版小程序码

#### 1. 登录后台
- 网址：https://cwsp.com/admin
- 刷新页面（Ctrl+F5）

#### 2. 进入商品编辑页
- 选择商品 ID = 39（或其他商品）
- 找到"视频列表二维码"模块

#### 3. 配置参数
- **日期：** 2026-02-12（或任意日期）
- **分类：** 生产全程回放（type=0）
- **环境：** ⚠️ **选择"体验版"**（重要！）

#### 4. 生成小程序码
- 点击"生成二维码"按钮
- 等待生成（会显示加载中）
- 成功后显示小程序码图片

#### 5. 验证生成信息
查看显示的信息：
```
环境：体验版 | 小程序路径：/packageA/goods/detail | 参数：id=39&date=20260212&type=0
```

确认：
- ✅ 环境显示"体验版"
- ✅ scene 参数格式正确（26字符）

---

### 第五步：扫码测试

#### 1. 使用体验版小程序扫码
⚠️ **重要：必须用已安装体验版的微信扫码！**

有两种方式：

**方式A：微信直接扫描**
- 打开微信
- 点击右上角"+"
- 选择"扫一扫"
- 扫描后台生成的小程序码

**方式B：在体验版小程序内扫描**
- 打开体验版小程序
- 使用小程序内的扫一扫功能（如果有）

#### 2. 预期效果
扫码后应该：
- ✅ 自动打开体验版小程序
- ✅ 进入商品详情页（商品 ID = 39）
- ✅ 商品信息完整显示
- ✅ 日期自动选中：2026-02-12
- ✅ 分类自动切换到："生产全程回放"
- ✅ 视频列表正常加载

#### 3. 调试检查
如果有微信开发者工具打开：
1. 打开"调试器" → "Console"
2. 查看日志输出
3. 应该能看到参数解析信息

---

## ⚠️ 常见问题

### Q1: 扫码后跳转到正式版，不是体验版

**原因：** 后台生成时选择了"正式版"环境

**解决：**
1. 后台重新生成
2. **确保选择"体验版"环境**
3. 重新扫码

---

### Q2: 扫码后提示"小程序未发布"

**原因：** 选择了"正式版"，但小程序还没发布

**解决：**
1. 后台选择"体验版"环境
2. 重新生成小程序码
3. 或者提交审核并发布正式版

---

### Q3: 体验版无法扫码，提示错误

**原因：** 体验成员未添加或未安装体验版

**解决：**
1. 确认已添加为体验成员
2. 扫描"体验版二维码"（在公众平台获取）
3. 安装体验版小程序
4. 再扫描后台生成的小程序码

---

### Q4: 扫码后商品信息不显示

**可能原因：**
1. 小程序代码未更新
2. 参数解析失败

**解决：**
1. 确认已上传新版本小程序
2. 确认已设为体验版
3. 查看控制台日志检查参数

---

### Q5: 日期和分类没有自动定位

**可能原因：**
1. 小程序代码未更新
2. 日期格式转换失败

**解决：**
1. 重新上传小程序
2. 检查代码中的日期转换逻辑
3. 查看控制台日志

---

## 🎯 快速测试清单

### 后台检查
- [ ] 登录后台并刷新页面（Ctrl+F5）
- [ ] 选择日期：2026-02-12
- [ ] 选择分类：生产全程回放
- [ ] ⚠️ **选择环境：体验版**
- [ ] 点击"生成二维码"
- [ ] 显示信息包含"环境：体验版"
- [ ] 成功生成小程序码图片

### 小程序检查
- [ ] 微信开发者工具已上传
- [ ] 版本号：v1.5.2
- [ ] 公众平台已设为体验版
- [ ] 已添加体验成员
- [ ] 体验成员已扫描体验版二维码并安装

### 扫码测试
- [ ] 使用已安装体验版的微信扫码
- [ ] 小程序正常打开（显示"体验版"标识）
- [ ] 进入商品详情页
- [ ] 商品信息显示正常
- [ ] 日期自动选中 2026-02-12
- [ ] 分类自动切换到"生产全程回放"
- [ ] 视频列表正常加载

---

## 📊 环境对照表

| 环境 | env_version | 说明 | 使用场景 |
|------|-------------|------|----------|
| **正式版** | release | 已发布的正式版本 | 所有用户可扫码 |
| **体验版** | trial | 测试版本 | 仅体验成员可扫码 |
| **开发版** | develop | 开发中版本 | 仅开发者可扫码 |

---

## 🔄 从体验版切换到正式版

### 1. 测试通过后
- 在微信公众平台
- "版本管理" → "体验版"
- 点击"提交审核"

### 2. 审核通过后
- 收到审核通过通知
- 点击"发布"按钮
- 发布到正式版

### 3. 后台切换环境
- 后台生成小程序码时
- **选择"正式版"环境**
- 重新生成小程序码
- 所有用户都可以扫码使用

---

## 💡 最佳实践

### 开发阶段
- 使用"体验版"环境
- 添加测试人员为体验成员
- 充分测试后再提交审核

### 上线后
- 切换到"正式版"环境
- 所有用户可扫码使用
- 新功能先在体验版测试

### 紧急修复
1. 修复代码
2. 上传新版本
3. 设为体验版测试
4. 测试通过后提交审核
5. 审核通过后发布

---

## 📞 技术支持

如有问题，请检查：
1. 服务器日志：`/www/wwwroot/cwls.turuifanxin.cn/runtime/log/`
2. 微信开发者工具控制台
3. 小程序审核状态

---

**测试完成后，记得将环境切换回正式版！** 🎉
