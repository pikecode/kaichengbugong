# å¼€æˆä¸å…¬ç”µå•†æº¯æºç³»ç»Ÿ - å®Œæ•´æ”¹åŠ¨æ¸…å•

**éƒ¨ç½²æ—¥æœŸï¼š** 2026å¹´2æœˆ6æ—¥
**ç‰ˆæœ¬ï¼š** v1.2.0
**ç³»ç»Ÿï¼š** FastAdmin + UniApp å¾®ä¿¡å°ç¨‹åº
**æœåŠ¡å™¨ï¼š** 8.154.32.2 (https://wx.kcbg.com.cn/)

---

## ğŸ“Š æ•°æ®åº“æ”¹åŠ¨

### 1. fa_shop_goods è¡¨
```sql
-- æ·»åŠ æº¯æºå›æ”¾åœ°å€å­—æ®µ
ALTER TABLE `fa_shop_goods`
ADD COLUMN `traceability_url` VARCHAR(255) DEFAULT NULL
COMMENT 'æº¯æºå›æ”¾åœ°å€ï¼ˆå°ç¨‹åºè·¯å¾„ï¼‰';
```

### 2. fa_shop_video è¡¨
```sql
-- ä¿®æ”¹ type å­—æ®µï¼Œæ·»åŠ å¤šè§†è§’å›æ”¾ç±»å‹
ALTER TABLE `fa_shop_video`
MODIFY COLUMN `type` SET('0','1','2') DEFAULT '0'
COMMENT 'è§†é¢‘ç±»å‹ï¼š0=å•†å“æº¯æºï¼Œ1=ç²¾å½©ç¬é—´ï¼Œ2=å¤šè§†è§’å›æ”¾';
```

### 3. fa_auth_rule è¡¨
```sql
-- ä¿®æ”¹é…æ–™å›æ”¾èœå•å¯è§æ€§
UPDATE fa_auth_rule SET ismenu = 1 WHERE id IN (321, 330, 339);
```

### 4. é…æ–™å›æ”¾ç›¸å…³è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰
- `fa_ingredientreplay` - é…æ–™å›æ”¾åˆ†ç±»è¡¨
- `fa_ingredientreplayitem` - é…æ–™å›æ”¾é¡¹ç›®è¡¨
- `fa_ingredientreplayitemvideo` - é…æ–™å›æ”¾è§†é¢‘è¡¨

---

## ğŸ”§ åç«¯æ–‡ä»¶æ”¹åŠ¨

### 1. API æ§åˆ¶å™¨
**æ–‡ä»¶ï¼š** `/www/wwwroot/cwls.turuifanxin.cn/addons/shop/controller/api/Goods.php`

**æ”¹åŠ¨ç‚¹1ï¼š** æ·»åŠ  API ç™½åå•ï¼ˆLine 29-35ï¼‰
```php
protected $noNeedLogin = [
    'index', 'detail', 'lists', 'getWxCode', 'getDateList', 'getVideoList',
    // æº¯æºæ¥å£
    'getTraceabilityInfo', 'getTraceabilityGoods', 'getTraceabilityGoodsVideoList',
    // é…æ–™å›æ”¾æ¥å£
    'getIngredientReplayList', 'getIngredientReplayInfo',
    'getIngredientReplayItem', 'getIngredientReplayItemVideoList'
];
```

**æ”¹åŠ¨ç‚¹2ï¼š** è¿”å›æº¯æºå›æ”¾åœ°å€ï¼ˆLine 204ï¼‰
```php
$row->visible(explode(',', '...,coupon,traceability_url'));
```

**æ”¹åŠ¨ç‚¹3ï¼š** æ–°å¢4ä¸ªé…æ–™å›æ”¾ API æ–¹æ³•ï¼ˆLine 369-449ï¼‰
- `getIngredientReplayList()` - è·å–é…æ–™å›æ”¾åˆ†ç±»åˆ—è¡¨
- `getIngredientReplayInfo()` - è·å–é…æ–™å›æ”¾åˆ†ç±»è¯¦æƒ…
- `getIngredientReplayItem()` - è·å–é…æ–™å›æ”¾é¡¹ç›®åˆ—è¡¨
- `getIngredientReplayItemVideoList()` - è·å–é…æ–™å›æ”¾è§†é¢‘åˆ—è¡¨

### 2. Video æ¨¡å‹
**æ–‡ä»¶ï¼š** `/www/wwwroot/cwls.turuifanxin.cn/application/admin/model/shop/Video.php`

**æ”¹åŠ¨ï¼š** æ›´æ–°è§†é¢‘ç±»å‹åˆ—è¡¨ï¼ˆLine 34-37ï¼‰
```php
public function getTypeList()
{
    return ['0' => __('å•†å“æº¯æº'), '1' => __('ç²¾å½©ç¬é—´'), '2' => __('å¤šè§†è§’å›æ”¾')];
}
```

### 3. åå°ç®¡ç† JS
**æ–‡ä»¶è·¯å¾„ï¼š** `/www/wwwroot/cwls.turuifanxin.cn/public/assets/js/backend/`

æ–°å¢æ–‡ä»¶ï¼š
- `ingredientreplay.js` (4.7KB) - é…æ–™å›æ”¾åˆ†ç±»ç®¡ç†
- `ingredientreplayitem.js` (4.6KB) - é…æ–™å›æ”¾é¡¹ç›®ç®¡ç†
- `ingredientreplayitemvideo.js` (3.2KB) - é…æ–™å›æ”¾è§†é¢‘ç®¡ç†

### 4. åå°è§†å›¾æ–‡ä»¶

#### 4.1 å•†å“ç¼–è¾‘é¡µé¢
**æ–‡ä»¶ï¼š** `/www/wwwroot/cwls.turuifanxin.cn/application/admin/view/shop/goods/edit.html`

**æ”¹åŠ¨1ï¼š** æ·»åŠ æº¯æºå›æ”¾åœ°å€è¾“å…¥æ¡†ï¼ˆLine 210-211ï¼‰
```html
<input id="c-traceability_url" name="row[traceability_url]"
       placeholder="ç²˜è´´æº¯æºå•†å“æˆ–é…æ–™å›æ”¾ç”Ÿæˆçš„åœ°å€">
```

**æ”¹åŠ¨2ï¼š** æ·»åŠ äºŒç»´ç ç”ŸæˆåŠŸèƒ½ï¼ˆLine 240-333ï¼‰
- æ—¥æœŸé€‰æ‹©å™¨
- è§†é¢‘åˆ†ç±»ä¸‹æ‹‰æ¡†
- äºŒç»´ç ç”ŸæˆæŒ‰é’®
- äºŒç»´ç æ˜¾ç¤ºåŒºåŸŸ
- ä¸‹è½½åŠŸèƒ½
- å¼•å…¥ qrcode.min.js åº“

#### 4.2 æº¯æºå•†å“ç¼–è¾‘é¡µé¢
**æ–‡ä»¶ï¼š** `/www/wwwroot/cwls.turuifanxin.cn/application/admin/view/traceabilitygoods/edit.html`

**æ”¹åŠ¨ï¼š** æ·»åŠ å°ç¨‹åºåœ°å€ç”Ÿæˆå’Œå¤åˆ¶åŠŸèƒ½ï¼ˆLine 39ï¼‰
```html
<input id="c-miniapp-url" readonly
       value="/pages/index/sycpvideo?id={$row.id}">
<button onclick="copyToClipboard()">å¤åˆ¶åœ°å€</button>
```

#### 4.3 é…æ–™å›æ”¾é¡¹ç›®ç¼–è¾‘é¡µé¢
**æ–‡ä»¶ï¼š** `/www/wwwroot/cwls.turuifanxin.cn/application/admin/view/ingredientreplayitem/edit.html`

**æ”¹åŠ¨ï¼š** æ·»åŠ å°ç¨‹åºåœ°å€ç”Ÿæˆå’Œå¤åˆ¶åŠŸèƒ½ï¼ˆLine 39ï¼‰
```html
<input id="c-miniapp-url" readonly
       value="/pages/ingredientreplay/videos?id={$row.id}">
<button onclick="copyToClipboard()">å¤åˆ¶åœ°å€</button>
```

### 5. ç¬¬ä¸‰æ–¹åº“
**æ–‡ä»¶ï¼š** `/www/wwwroot/cwls.turuifanxin.cn/public/assets/js/qrcode.min.js` (20KB)
**ç”¨é€”ï¼š** å‰ç«¯ç”ŸæˆäºŒç»´ç 

---

## ğŸ“± å°ç¨‹åºå‰ç«¯æ”¹åŠ¨

### 1. HTTP æ‹¦æˆªå™¨
**æ–‡ä»¶ï¼š** `cwlsuniapp/common/http.interceptor.js`

**æ”¹åŠ¨1ï¼š** ä¿®æ”¹æ¥å£åœ°å€ï¼ˆLine 56-57ï¼‰
```javascript
// ä»æœ¬åœ°æ”¹ä¸ºçº¿ä¸Š
let url = 'https://wx.kcbg.com.cn/';
```

**æ”¹åŠ¨2ï¼š** æ·»åŠ  API ç™½åå•ï¼ˆLine 40-49ï¼‰
```javascript
const noNeedLogin = [
    // æº¯æºæ¥å£
    '/addons/shop/api.goods/getTraceabilityInfo',
    '/addons/shop/api.goods/getTraceabilityGoods',
    '/addons/shop/api.goods/getTraceabilityGoodsVideoList',
    // é…æ–™å›æ”¾æ¥å£
    '/addons/shop/api.goods/getIngredientReplayList',
    '/addons/shop/api.goods/getIngredientReplayInfo',
    '/addons/shop/api.goods/getIngredientReplayItem',
    '/addons/shop/api.goods/getIngredientReplayItemVideoList'
];
```

### 2. å•†å“è¯¦æƒ…é¡µ
**æ–‡ä»¶ï¼š** `cwlsuniapp/pages/goods/detail.vue`

**æ”¹åŠ¨1ï¼š** æ·»åŠ  data å±æ€§ï¼ˆLine 433-434ï¼‰
```javascript
targetDate: null,  // ç›®æ ‡æ—¥æœŸï¼ˆä»URLå‚æ•°è·å–ï¼‰
targetType: null   // ç›®æ ‡è§†é¢‘åˆ†ç±»ï¼ˆä»URLå‚æ•°è·å–ï¼‰
```

**æ”¹åŠ¨2ï¼š** ä¿®æ”¹ onLoad æ–¹æ³•ï¼ˆLine 345, 351ï¼‰
```javascript
// æ¥æ”¶æ—¥æœŸå‚æ•°
if (e.date) {
    this.targetDate = e.date;
}
// æ¥æ”¶åˆ†ç±»å‚æ•°
if (e.type !== undefined) {
    this.targetType = parseInt(e.type);
}
```

**æ”¹åŠ¨3ï¼š** ä¿®æ”¹ getDateList æ–¹æ³•ï¼ˆLine 488-496ï¼‰
```javascript
// è‡ªåŠ¨é€‰æ‹©ç›®æ ‡æ—¥æœŸ
if (this.targetDate && this.datearr.length > 0) {
    const targetIndex = this.datearr.findIndex(item => item.riqi === this.targetDate);
    if (targetIndex !== -1) {
        this.riindex = targetIndex;
    }
    this.targetDate = null;
}
```

**æ”¹åŠ¨4ï¼š** è·³è½¬åˆ°æº¯æºå›æ”¾é¡µé¢ï¼ˆLine 454-456, 537-539ï¼‰
```javascript
// ç‚¹å‡»"é…æ–™å›æ”¾"æ ‡ç­¾è·³è½¬
if (this.info.traceability_url) {
    uni.navigateTo({ url: this.info.traceability_url });
}
```

### 3. åˆ†åŒ…é…ç½®
**æ–‡ä»¶ï¼š** `cwlsuniapp/pages.json`

**æ”¹åŠ¨ï¼š** é‡æ„ä¸ºä¸»åŒ…+åˆ†åŒ…ç»“æ„ï¼Œè§£å†³ 2MB é™åˆ¶

**ä¸»åŒ…ï¼ˆ6ä¸ªé¡µé¢ï¼‰ï¼š**
- pages/index/index
- pages/cart/cart
- pages/my/my
- pages/login/login
- pages/login/mobilelogin
- pages/goods/detail

**åˆ†åŒ… subpkgï¼ˆ39ä¸ªé¡µé¢ï¼‰ï¼š**
- ç”¨æˆ·åŠŸèƒ½ï¼šmy/profile, login/register, signin/*, coupon/*, score/*
- è®¢å•åŠŸèƒ½ï¼šgoods/order, order/*, address/*
- å…¶ä»–åŠŸèƒ½ï¼šcategory/*, remark/*, search/*, ingredientreplay/*, ç­‰

### 4. ç¼–è¯‘é…ç½®ä¼˜åŒ–
**æ–‡ä»¶ï¼š** `cwlsuniapp/manifest.json`

**æ”¹åŠ¨ï¼š** å¯ç”¨ä¼˜åŒ–é€‰é¡¹
```json
"mp-weixin": {
    "setting": {
        "es6": true,
        "minified": true,
        "postcss": true
    },
    "optimization": {
        "subPackages": true
    }
}
```

### 5. é™æ€èµ„æº CDN åŒ–
**æœ¬åœ° static/ ç›®å½•ï¼š** 780KB â†’ 56KBï¼ˆä»…ä¿ç•™ tabBar å›¾æ ‡ï¼‰
**CDN åœ°å€ï¼š** https://wx.kcbg.com.cn/miniapp-static/

---

## ğŸ“‹ æ–°å¢é¡µé¢

### å°ç¨‹åºé¡µé¢
1. `pages/ingredientreplay/list.vue` - é…æ–™å›æ”¾åˆ—è¡¨é¡µ
2. `pages/ingredientreplay/items.vue` - é…æ–™å›æ”¾é¡¹ç›®é¡µ
3. `pages/ingredientreplay/videos.vue` - é…æ–™å›æ”¾è§†é¢‘é¡µ
4. `pages/index/plhf.vue` - é…æ–™å›æ”¾å…¥å£é¡µ

### åå°ç®¡ç†é¡µé¢
1. é…æ–™å›æ”¾åˆ†ç±»ç®¡ç†ï¼ˆCRUDï¼‰
2. é…æ–™å›æ”¾é¡¹ç›®ç®¡ç†ï¼ˆCRUDï¼‰
3. é…æ–™å›æ”¾è§†é¢‘ç®¡ç†ï¼ˆCRUDï¼‰

---

## ğŸ”‘ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. é…æ–™å›æ”¾åŠŸèƒ½
- âœ… ä¸‰çº§ç»“æ„ï¼šåˆ†ç±» â†’ é¡¹ç›® â†’ è§†é¢‘
- âœ… åå° CRUD ç®¡ç†
- âœ… å°ç¨‹åºå±•ç¤ºå’Œæ’­æ”¾
- âœ… API æ¥å£æ”¯æŒ

### 2. è§†é¢‘åˆ—è¡¨äºŒç»´ç åŠŸèƒ½
- âœ… åå°ç”ŸæˆäºŒç»´ç ï¼ˆé€‰æ‹©æ—¥æœŸ+åˆ†ç±»ï¼‰
- âœ… äºŒç»´ç ä¸‹è½½åŠŸèƒ½
- âœ… æ‰«ç è‡ªåŠ¨å®šä½åˆ°æŒ‡å®šæ—¥æœŸå’Œåˆ†ç±»
- âœ… æ”¯æŒå‚æ•°ï¼š`?id=33&date=2024-10-15&type=0`

### 3. æº¯æºå›æ”¾åœ°å€ç”Ÿæˆ
- âœ… æº¯æºå•†å“è‡ªåŠ¨ç”Ÿæˆåœ°å€ï¼š`/pages/index/sycpvideo?id={ID}`
- âœ… é…æ–™å›æ”¾è‡ªåŠ¨ç”Ÿæˆåœ°å€ï¼š`/pages/ingredientreplay/videos?id={ID}`
- âœ… ä¸€é”®å¤åˆ¶åŠŸèƒ½
- âœ… å•†å“è¯¦æƒ…é¡µæ˜¾ç¤ºå…¥å£

### 4. å¤šè§†è§’å›æ”¾
- âœ… æ•°æ®åº“æ”¯æŒ type='2'
- âœ… åå°å¯ç»´æŠ¤å¤šè§†è§’å›æ”¾è§†é¢‘
- âœ… å‰ç«¯æ­£å¸¸å±•ç¤º

### 5. å°ç¨‹åºåˆ†åŒ…ä¼˜åŒ–
- âœ… ä¸»åŒ…ï¼š6ä¸ªæ ¸å¿ƒé¡µé¢ï¼ˆ500KB å·¦å³ï¼‰
- âœ… åˆ†åŒ…ï¼š39ä¸ªæ¬¡è¦é¡µé¢
- âœ… æ€»åŒ…å¤§å°ï¼š2.7MB â†’ ç¬¦åˆå¾®ä¿¡è¦æ±‚
- âœ… CDN é™æ€èµ„æºåŠ è½½

---

## ğŸ§ª æµ‹è¯•éªŒè¯æ¸…å•

### æ•°æ®åº“
- [x] fa_shop_goods.traceability_url å­—æ®µå­˜åœ¨
- [x] fa_shop_video.type æ”¯æŒå€¼ '2'
- [x] fa_auth_rule èœå•å¯è§æ€§æ­£ç¡®

### åç«¯ API
- [x] GET /addons/shop/api.goods/getIngredientReplayList - 200 OK
- [x] GET /addons/shop/api.goods/getIngredientReplayInfo - 200 OK
- [x] GET /addons/shop/api.goods/getIngredientReplayItem - 200 OK
- [x] GET /addons/shop/api.goods/getIngredientReplayItemVideoList - 200 OK
- [x] GET /addons/shop/api.goods/detail è¿”å› traceability_url

### åå°ç®¡ç†
- [x] é…æ–™å›æ”¾èœå•æ˜¾ç¤ºæ­£å¸¸
- [x] é…æ–™å›æ”¾ CRUD åŠŸèƒ½æ­£å¸¸
- [x] å•†å“ç¼–è¾‘é¡µé¢æ˜¾ç¤ºæº¯æºåœ°å€å­—æ®µ
- [x] å•†å“ç¼–è¾‘é¡µé¢äºŒç»´ç ç”ŸæˆåŠŸèƒ½æ­£å¸¸
- [x] æº¯æºå•†å“/é…æ–™å›æ”¾é¡¹ç›®ç”Ÿæˆå°ç¨‹åºåœ°å€
- [x] è§†é¢‘ç®¡ç†æ”¯æŒå¤šè§†è§’å›æ”¾ç±»å‹

### å°ç¨‹åºå‰ç«¯
- [x] æ¥å£åœ°å€æ”¹ä¸ºçº¿ä¸Šç¯å¢ƒ
- [x] é…æ–™å›æ”¾ç›¸å…³æ¥å£å…ç™»å½•è®¿é—®
- [x] äºŒç»´ç æ‰«ç å‚æ•°æ¥æ”¶æ­£å¸¸
- [x] æ—¥æœŸå’Œåˆ†ç±»è‡ªåŠ¨å®šä½æ­£å¸¸
- [x] å•†å“è¯¦æƒ…é¡µæº¯æºå›æ”¾å…¥å£æ˜¾ç¤º
- [x] ç‚¹å‡»æº¯æºå›æ”¾å…¥å£è·³è½¬æ­£å¸¸
- [x] å°ç¨‹åºåˆ†åŒ…ç¼–è¯‘æˆåŠŸ
- [x] åŒ…å¤§å°ç¬¦åˆ 2MB é™åˆ¶

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

### æ•°æ®åº“è„šæœ¬
- æ•°æ®åº“æ”¹åŠ¨å·²ç›´æ¥åœ¨æœåŠ¡å™¨æ‰§è¡Œ

### åç«¯æ–‡ä»¶ï¼ˆå·²éƒ¨ç½²ï¼‰
- `/www/wwwroot/cwls.turuifanxin.cn/addons/shop/controller/api/Goods.php`
- `/www/wwwroot/cwls.turuifanxin.cn/application/admin/model/shop/Video.php`
- `/www/wwwroot/cwls.turuifanxin.cn/public/assets/js/backend/ingredientreplay.js`
- `/www/wwwroot/cwls.turuifanxin.cn/public/assets/js/backend/ingredientreplayitem.js`
- `/www/wwwroot/cwls.turuifanxin.cn/public/assets/js/backend/ingredientreplayitemvideo.js`
- `/www/wwwroot/cwls.turuifanxin.cn/public/assets/js/qrcode.min.js`
- `/www/wwwroot/cwls.turuifanxin.cn/application/admin/view/shop/goods/edit.html`
- `/www/wwwroot/cwls.turuifanxin.cn/application/admin/view/traceabilitygoods/edit.html`
- `/www/wwwroot/cwls.turuifanxin.cn/application/admin/view/ingredientreplayitem/edit.html`

### å‰ç«¯æ–‡ä»¶ï¼ˆéœ€é‡æ–°ç¼–è¯‘ï¼‰
- `cwlsuniapp/common/http.interceptor.js`
- `cwlsuniapp/pages/goods/detail.vue`
- `cwlsuniapp/pages.json`
- `cwlsuniapp/manifest.json`
- `cwlsuniapp/pages/ingredientreplay/*.vue`
- `cwlsuniapp/pages/index/plhf.vue`

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å°ç¨‹åºç¼–è¯‘
- ä½¿ç”¨ HBuilderX é‡æ–°ç¼–è¯‘å°ç¨‹åº
- ç¡®è®¤åˆ†åŒ…é…ç½®æ­£ç¡®
- éªŒè¯åŒ…å¤§å°ç¬¦åˆè¦æ±‚ï¼ˆ<2MB ä¸»åŒ…ï¼‰

### 2. ç¼“å­˜æ¸…ç†
éƒ¨ç½²åéœ€æ¸…ç†ç¼“å­˜ï¼š
```bash
rm -rf /www/wwwroot/cwls.turuifanxin.cn/runtime/cache/*
```

### 3. æ¥å£æµ‹è¯•
éƒ¨ç½²ååŠ¡å¿…æµ‹è¯•æ‰€æœ‰æ–°å¢æ¥å£ï¼š
- é…æ–™å›æ”¾ 4ä¸ªæ¥å£
- å•†å“è¯¦æƒ…æ¥å£è¿”å› traceability_url

### 4. æƒé™é…ç½®
ç¡®è®¤åå°ç®¡ç†å‘˜æœ‰é…æ–™å›æ”¾èœå•æƒé™

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**æœåŠ¡å™¨ä¿¡æ¯ï¼š**
- IP: 8.154.32.2
- SSH: root / Pp@123456
- MySQL: cwls / ewXHjm77twRm3xL2
- é¡¹ç›®è·¯å¾„: /www/wwwroot/cwls.turuifanxin.cn/
- åŸŸå: https://wx.kcbg.com.cn/

**éƒ¨ç½²å®Œæˆæ—¶é—´ï¼š** 2026å¹´2æœˆ6æ—¥
**éƒ¨ç½²äººå‘˜ï¼š** Claude â€‹Code
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
